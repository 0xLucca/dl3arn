import { ConnectButton } from "@rainbow-me/rainbowkit";
import type { NextPage } from "next";
import Head from "next/head";
import { useAccount, useContractRead } from "wagmi";
import styles from "../styles/Home.module.css";
import { NFTabi } from "../abis/NFTabi";
import React from "react";

const CONTRACT_ADDRESS = "0x635321aDC5912Ede895F144CC9048baAE24e6E67";
const CHAIN_ID = 4;

const Home: NextPage = () => {
  const [lockedPage, setLockedPage] = React.useState(true);
  const [readEnable, setReadEnable] = React.useState(false);

  const contractConfig = {
    addressOrName: CONTRACT_ADDRESS,
    contractInterface: NFTabi,
  };

  const { address, isConnected } = useAccount({
    onDisconnect() {
      setReadEnable(false);
      setLockedPage(true);
    },
    onConnect() {
      setReadEnable(true);
    },
  });

  const { data: hasNft, error: fetchError } = useContractRead({
    ...contractConfig,
    functionName: "balanceOf",
    watch: false,
    args: [address, 1],
    enabled: readEnable,
    chainId: CHAIN_ID,
  });

  React.useEffect(() => {
    if (isConnected) {
      let result = hasNft?.toNumber();
      if (!!result) {
        setLockedPage(false);
      } else {
        setLockedPage(true);
      }
    }
  }, [address]);

  return (
    <div>
      <Head>
        <title>DL3arn | Landing</title>
        <meta
          name="description"
          content="Generated by @rainbow-me/create-rainbowkit"
        />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main style={{ display: "grid", placeItems: "center", height: "100vh" }}>
        <div>
          <h1>DL3arn</h1>
          <ConnectButton />
        </div>
        <div>
          <h1 style={{ margin: "12px 0 24px" }}>
            Locked Page: {lockedPage.toString()}
          </h1>
        </div>
      </main>
    </div>
  );
};

export default Home;
